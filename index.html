<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Chiro Huddle</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.svg">
</head>
<body>
    <!-- Lock Screen -->
    <div id="lockScreen" class="lock-screen">
        <div class="lock-container">
            <div class="lock-icon">üîê</div>
            <h1>Chiro Huddle</h1>
            <p class="hipaa-notice">HIPAA Compliant ‚Ä¢ Local Storage Only</p>
            <div class="passcode-display">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
            <div class="passcode-pad">
                <button class="num-btn" data-num="1">1</button>
                <button class="num-btn" data-num="2">2</button>
                <button class="num-btn" data-num="3">3</button>
                <button class="num-btn" data-num="4">4</button>
                <button class="num-btn" data-num="5">5</button>
                <button class="num-btn" data-num="6">6</button>
                <button class="num-btn" data-num="7">7</button>
                <button class="num-btn" data-num="8">8</button>
                <button class="num-btn" data-num="9">9</button>
                <button class="num-btn biometric" id="biometricBtn">üîë</button>
                <button class="num-btn" data-num="0">0</button>
                <button class="num-btn delete" id="deleteBtn">‚å´</button>
            </div>
            <p class="error-msg" id="errorMsg"></p>
        </div>
    </div>

    <!-- Setup Screen (First Time) -->
    <div id="setupScreen" class="setup-screen hidden">
        <div class="setup-container">
            <h1>Set Up Passcode</h1>
            <p>Create a 4-digit passcode to protect patient data</p>
            <div class="passcode-display">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
            <div class="passcode-pad">
                <button class="num-btn" data-num="1">1</button>
                <button class="num-btn" data-num="2">2</button>
                <button class="num-btn" data-num="3">3</button>
                <button class="num-btn" data-num="4">4</button>
                <button class="num-btn" data-num="5">5</button>
                <button class="num-btn" data-num="6">6</button>
                <button class="num-btn" data-num="7">7</button>
                <button class="num-btn" data-num="8">8</button>
                <button class="num-btn" data-num="9">9</button>
                <button class="num-btn" disabled></button>
                <button class="num-btn" data-num="0">0</button>
                <button class="num-btn delete" id="setupDeleteBtn">‚å´</button>
            </div>
            <p class="setup-status" id="setupStatus">Enter new passcode</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="main-app hidden">

        <!-- ========== HOME SCREEN ========== -->
        <div id="homeScreen" class="screen active">
            <div class="home-container">
                <div class="home-header">
                    <h1>Chiro Huddle</h1>
                    <p class="date-display" id="dateDisplay"></p>
                </div>

                <div class="home-buttons">
                    <button class="huddle-start-btn evening" id="startEveningBtn">
                        <span class="btn-icon">üåô</span>
                        <span class="btn-text">Start Evening Huddle</span>
                        <span class="btn-subtitle">PMT ‚Ä¢ Insurance ‚Ä¢ No Appt ‚Ä¢ Charges ‚Ä¢ To-Do ‚Ä¢ Chiro180 ‚Ä¢ Verification</span>
                    </button>
                </div>

                <div class="home-footer">
                    <button class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                    <button class="icon-btn" id="lockBtn" title="Lock">üîí</button>
                </div>
            </div>
        </div>

        <!-- ========== PATIENT LIST SCREEN ========== -->
        <div id="patientListScreen" class="screen">
            <div class="workflow-header">
                <button class="back-btn" id="backToHome">‚Üê Back</button>
                <div class="workflow-title">
                    <h2 id="patientListTitle">Evening Huddle</h2>
                    <p class="step-indicator">Step 1 of 8</p>
                </div>
                <div class="workflow-spacer"></div>
            </div>

            <div class="workflow-content">
                <div class="patient-input-section">
                    <h3>üìã Today's Patient List</h3>
                    <p>Paste patient names below (one per line) to create quick-tap buttons</p>
                    <textarea id="patientPaste" placeholder="Paste patient names here...
John Smith
Jane Doe
Bob Johnson"></textarea>
                    <div class="patient-actions">
                        <button class="action-btn secondary" id="clearPaste">Clear</button>
                        <button class="action-btn primary" id="loadPatients">Load Patients</button>
                    </div>
                </div>

                <div class="loaded-patients" id="loadedPatients">
                    <p class="empty-state">No patients loaded yet</p>
                </div>
            </div>

            <div class="workflow-footer">
                <div class="patient-count">
                    <span id="patientCountDisplay">0 patients loaded</span>
                </div>
                <button class="continue-btn" id="continueToHuddle" disabled>
                    Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- ========== HUDDLE SECTION SCREEN ========== -->
        <div id="huddleSectionScreen" class="screen">
            <div class="workflow-header">
                <button class="back-btn" id="backToPrevSection">‚Üê Back</button>
                <div class="workflow-title">
                    <h2 id="sectionTitle">PMT Issues</h2>
                    <p class="step-indicator" id="stepIndicator">Step 2 of 8</p>
                </div>
                <div class="workflow-spacer"></div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="workflow-content section-content-area">
                <!-- Section Icon & Info -->
                <div class="section-info" id="sectionInfo">
                    <span class="section-icon" id="sectionIcon">üí∞</span>
                    <p class="section-description" id="sectionDescription">Track payment issues</p>
                </div>

                <!-- Added Items List -->
                <div class="added-items-container">
                    <h4>Added Items <span class="item-count-badge" id="itemCountBadge">0</span></h4>
                    <div class="added-items-list" id="addedItemsList">
                        <p class="empty-state">No items added yet. Tap a patient below to add.</p>
                    </div>
                </div>

                <!-- Dynamic Section Content (varies by section type) -->
                <div id="sectionContent">
                    <!-- Patient Selection Grid (default) -->
                    <div class="patient-selection" id="patientSelectionArea">
                        <h4>Tap to Add Patient</h4>
                        <div class="patient-grid" id="patientGrid"></div>
                    </div>
                </div>
            </div>

            <div class="workflow-footer">
                <button class="export-section-btn" id="exportSectionBtn">
                    üìä Add to Excel Tracker
                </button>
                <button class="next-btn" id="nextSectionBtn">
                    Next ‚Üí
                </button>
            </div>
        </div>

        <!-- ========== TODO SECTION SCREEN (for 24 Hour To-Do) ========== -->
        <div id="todoSectionScreen" class="screen">
            <div class="workflow-header">
                <button class="back-btn" id="backFromTodo">‚Üê Back</button>
                <div class="workflow-title">
                    <h2>24 Hour To-Do</h2>
                    <p class="step-indicator" id="todoStepIndicator">Step 6 of 8</p>
                </div>
                <div class="workflow-spacer"></div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="todoProgressBar"></div>
            </div>

            <div class="workflow-content">
                <div class="section-info">
                    <span class="section-icon">üìù</span>
                    <p class="section-description">Tasks to complete in the next 24 hours</p>
                </div>

                <div class="todo-input-area">
                    <div class="todo-add-row">
                        <input type="text" id="todoInput" placeholder="Add a task..." class="todo-input">
                        <button class="action-btn primary" id="addTodoBtn">Add</button>
                    </div>
                </div>

                <div class="todo-list" id="todoList">
                    <p class="empty-state">No tasks added yet</p>
                </div>
            </div>

            <div class="workflow-footer">
                <button class="export-section-btn" id="exportTodoBtn">
                    üìä Add to Excel Tracker
                </button>
                <button class="next-btn" id="nextFromTodo">
                    Next ‚Üí
                </button>
            </div>
        </div>

        <!-- ========== CHIRO 180 SECTION SCREEN ========== -->
        <div id="chiro180SectionScreen" class="screen">
            <div class="workflow-header">
                <button class="back-btn" id="backFromChiro180">‚Üê Back</button>
                <div class="workflow-title">
                    <h2>Chiro 180 Updates</h2>
                    <p class="step-indicator" id="chiro180StepIndicator">Step 7 of 8</p>
                </div>
                <div class="workflow-spacer"></div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="chiro180ProgressBar"></div>
            </div>

            <div class="workflow-content">
                <div class="section-info">
                    <span class="section-icon">üì±</span>
                    <p class="section-description">Track Chiro 180 app update status for each patient</p>
                </div>

                <div class="toggle-patient-list" id="chiro180List">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <div class="workflow-footer">
                <button class="export-section-btn" id="exportChiro180Btn">
                    üìä Add to Excel Tracker
                </button>
                <button class="next-btn" id="nextFromChiro180">
                    Next ‚Üí
                </button>
            </div>
        </div>

        <!-- ========== INSURANCE VERIFICATION SECTION SCREEN ========== -->
        <div id="insuranceVerifySectionScreen" class="screen">
            <div class="workflow-header">
                <button class="back-btn" id="backFromInsVerify">‚Üê Back</button>
                <div class="workflow-title">
                    <h2>Confirm Insurance Verification</h2>
                    <p class="step-indicator" id="insVerifyStepIndicator">Step 8 of 8</p>
                </div>
                <div class="workflow-spacer"></div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="insVerifyProgressBar"></div>
            </div>

            <div class="workflow-content">
                <div class="section-info">
                    <span class="section-icon">‚úÖ</span>
                    <p class="section-description">Confirm insurance verification status for each patient</p>
                </div>

                <div class="checkbox-patient-list" id="insuranceVerifyList">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <div class="workflow-footer">
                <button class="export-section-btn" id="exportInsVerifyBtn">
                    üìä Add to Excel Tracker
                </button>
                <button class="next-btn" id="nextFromInsVerify">
                    Complete Huddle ‚úì
                </button>
            </div>
        </div>

        <!-- ========== COMPLETION SCREEN ========== -->
        <div id="completionScreen" class="screen">
            <div class="completion-container">
                <div class="completion-icon" id="completionIcon">‚úÖ</div>
                <h2 id="completionTitle">Evening Huddle Complete!</h2>
                <p class="completion-subtitle" id="completionSubtitle">All sections have been reviewed</p>

                <div class="completion-summary" id="completionSummary">
                    <!-- Summary will be populated dynamically -->
                </div>

                <div class="completion-actions">
                    <button class="action-btn primary large" id="exportToDriveBtn">
                        üìä Export All to Google Sheets
                    </button>
                    <button class="action-btn primary large" id="sendEmailBtn">
                        üìß Send Summary Email
                    </button>
                    <button class="action-btn secondary large" id="returnHome">
                        Return to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Note Modal (for patient notes) -->
    <div id="noteModal" class="modal hidden">
        <div class="modal-content note-modal">
            <div class="modal-header">
                <h2 id="noteModalTitle">Add Note</h2>
                <button class="close-modal" id="closeNoteModal">‚úï</button>
            </div>
            <div class="modal-body">
                <p class="note-patient" id="notePatientName"></p>
                <div class="quick-notes" id="quickNotes"></div>
                <textarea id="customNote" placeholder="Or type a custom note..."></textarea>
                <div class="modal-actions">
                    <button class="action-btn secondary" id="cancelNote">Cancel</button>
                    <button class="action-btn primary" id="saveNote">Add to List</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Charge Modal (for multi-select charge codes) -->
    <div id="chargeModal" class="modal hidden">
        <div class="modal-content charge-modal">
            <div class="modal-header">
                <h2>Charge and Passdown</h2>
                <button class="close-modal" id="closeChargeModal">‚úï</button>
            </div>
            <div class="modal-body">
                <p class="note-patient" id="chargePatientName"></p>
                <div class="charge-codes-grid" id="chargeCodesGrid">
                    <!-- Populated dynamically -->
                </div>
                <textarea id="chargeCustomNote" placeholder="Additional notes..."></textarea>
                <div class="modal-actions">
                    <button class="action-btn secondary" id="cancelCharge">Cancel</button>
                    <button class="action-btn primary" id="saveCharge">Add to List</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-modal" id="closeSettings">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <h3>Security</h3>
                    <button class="setting-btn" id="changePasscode">Change Passcode</button>
                    <div class="setting-row">
                        <span>Auto-lock timeout</span>
                        <select id="lockTimeout">
                            <option value="1">1 minute</option>
                            <option value="5" selected>5 minutes</option>
                            <option value="10">10 minutes</option>
                            <option value="15">15 minutes</option>
                        </select>
                    </div>
                </div>
                <div class="setting-group">
                    <h3>Google Drive</h3>
                    <div id="driveNotConnected">
                        <p class="setting-description">Save Excel trackers to Google Drive for easy access across devices.</p>
                        <button class="setting-btn primary" id="connectDrive">
                            <span class="drive-icon">üìÅ</span> Connect to Google Drive
                        </button>
                    </div>
                    <div id="driveConnected" class="hidden">
                        <div class="drive-status">
                            <span class="status-icon">‚úÖ</span>
                            <span>Connected to Google Drive</span>
                        </div>
                        <a href="#" id="openDriveFolder" class="drive-link" target="_blank">
                            Open "Chiro Huddle Exports" folder ‚Üí
                        </a>
                        <button class="setting-btn" id="disconnectDrive">Disconnect</button>
                    </div>
                    <p class="hipaa-note">Note: Only Excel exports go to Drive. Patient data stays encrypted locally (HIPAA compliant).</p>
                </div>
                <div class="setting-group">
                    <h3>Email Settings</h3>
                    <div class="setting-row">
                        <span>Summary email to:</span>
                        <input type="email" id="emailRecipient" placeholder="your@email.com" class="email-input">
                    </div>
                    <button class="setting-btn" id="saveEmailBtn">Save Email</button>
                    <p class="setting-note">Huddle summaries will be sent to this email address.</p>
                </div>
                <div class="setting-group">
                    <h3>Data Management</h3>
                    <button class="setting-btn" id="exportAllData">Export All Data</button>
                    <button class="setting-btn danger" id="clearAllData">Clear All Data</button>
                </div>
                <div class="setting-group">
                    <h3>About</h3>
                    <p class="about-text">Chiro Huddle v2.0<br>
                    All data stored locally on this device.<br>
                    Excel exports sync to Google Drive ‚Ä¢ HIPAA Focused</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Preview Modal -->
    <div id="emailModal" class="modal hidden">
        <div class="modal-content email-modal">
            <div class="modal-header">
                <h2>Email Summary Preview</h2>
                <button class="close-modal" id="closeEmailModal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="email-preview" id="emailPreview">
                    <!-- Email content preview -->
                </div>
                <div class="modal-actions">
                    <button class="action-btn secondary" id="cancelEmail">Cancel</button>
                    <button class="action-btn primary" id="confirmSendEmail">Send Email</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <script src="crypto.js"></script>
    <script src="storage.js"></script>
    <script src="googledrive.js"></script>
    <script src="excel.js"></script>
    <script src="email.js"></script>
    <script src="app.js"></script>
</body>
</html>
